<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pocafy - Podcast Platform</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#6366F1',
            secondary: '#10B981',
            accent: '#F59E0B',
            dark: '#1F2937',
            darker: '#111827',
            light: '#F3F4F6'
          },
          fontFamily: {
            sans: ['Inter', 'sans-serif'],
          }
        }
      }
    }
    
    // Global functions for UI navigation
    function showAdminLogin() {
      hideAll();
      document.getElementById('adminLogin').classList.remove('hidden');
    }
    
    function showListenerLogin() {
      hideAll();
      document.getElementById('listenerLogin').classList.remove('hidden');
    }
    
    function backToRoleSelection() {
      hideAll();
      document.getElementById('roleSelection').classList.remove('hidden');
    }
    
    function hideAll() {
      document.getElementById('roleSelection').classList.add('hidden');
      document.getElementById('adminLogin').classList.add('hidden');
      document.getElementById('listenerLogin').classList.add('hidden');
      document.getElementById('adminArea').classList.add('hidden');
      document.getElementById('listenerArea').classList.add('hidden');
    }
  </script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    
    body {
      font-family: 'Inter', sans-serif;
    }
    
    .gradient-text {
      background: linear-gradient(90deg, #6366F1, #10B981);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    
    .gradient-bg {
      background: linear-gradient(135deg, #111827, #1F2937);
    }
    
    .card {
      background: rgba(31, 41, 55, 0.7);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .podcast-card {
      transition: all 0.3s ease;
      background: rgba(31, 41, 55, 0.5);
    }
    
    .podcast-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3);
      background: rgba(31, 41, 55, 0.7);
    }
    
    .audio-player {
      filter: invert(1);
      width: 100%;
    }
    
    .waveform {
      height: 50px;
      background: linear-gradient(90deg, #6366F1, #10B981);
      opacity: 0.7;
      border-radius: 4px;
      position: relative;
      overflow: hidden;
    }
    
    .waveform::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, 
        transparent 0%, 
        rgba(255,255,255,0.3) 50%, 
        transparent 100%);
      animation: wave 2s linear infinite;
    }
    
    @keyframes wave {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }
    
    .file-upload {
      border: 2px dashed rgba(255, 255, 255, 0.2);
      transition: all 0.3s ease;
    }
    
    .file-upload:hover {
      border-color: #6366F1;
      background: rgba(99, 102, 241, 0.1);
    }
    
    .file-upload.dragover {
      border-color: #10B981;
      background: rgba(16, 185, 129, 0.1);
    }
    
    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: #1F2937;
    }
    
    ::-webkit-scrollbar-thumb {
      background: #4B5563;
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: #6B7280;
    }
  </style>
</head>
<body class="gradient-bg text-gray-100 min-h-screen">
  <div class="container mx-auto px-4 py-8 flex flex-col items-center">
    <!-- Welcome Section -->
    <div id="roleSelection" class="w-full max-w-md text-center">
      <div class="mb-8">
        <h1 class="text-5xl font-bold mb-2 gradient-text">Pocafy</h1>
        <p class="text-gray-400">Your premium podcast experience</p>
      </div>
      
      <div class="card rounded-2xl p-8 shadow-xl">
        <div class="waveform mb-6"></div>
        <h2 class="text-2xl font-semibold mb-4">Welcome to Pocafy</h2>
        <p class="text-gray-300 mb-6">
          Discover amazing podcasts or share your own content with the world. 
          Choose your role to continue.
        </p>
        
        <div class="flex flex-col space-y-4">
          <button onclick="showAdminLogin()" class="bg-primary hover:bg-indigo-600 text-white font-bold py-3 px-6 rounded-lg flex items-center justify-center space-x-2 transition transform hover:scale-105">
            <i class="fas fa-user-shield"></i>
            <span>For Admin</span>
          </button>
          <button onclick="showListenerLogin()" class="bg-secondary hover:bg-emerald-600 text-white font-bold py-3 px-6 rounded-lg flex items-center justify-center space-x-2 transition transform hover:scale-105">
            <i class="fas fa-headphones"></i>
            <span>For Listener</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Admin Password Login -->
    <div id="adminLogin" class="hidden w-full max-w-md">
      <div class="card rounded-2xl p-8 shadow-xl">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-2xl font-semibold">Admin Login</h2>
          <button onclick="backToRoleSelection()" class="text-gray-400 hover:text-white transition">
            <i class="fas fa-arrow-left"></i>
          </button>
        </div>
        
        <div class="space-y-4">
          <div>
            <label for="adminPassword" class="block text-gray-300 mb-2">Password</label>
            <input id="adminPassword" type="password" placeholder="Enter admin password"
                    class="w-full px-4 py-3 rounded-lg bg-gray-700 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-primary transition"/>
          </div>
          
          <button onclick="checkAdminPassword()"
                  class="w-full bg-primary hover:bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg transition transform hover:scale-[1.02]">
            Login
          </button>
        </div>
      </div>
    </div>

    <!-- Listener Login/Register -->
    <div id="listenerLogin" class="hidden w-full max-w-md">
      <div class="card rounded-2xl p-8 shadow-xl">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-2xl font-semibold">Listener Access</h2>
          <button onclick="backToRoleSelection()" class="text-gray-400 hover:text-white transition">
            <i class="fas fa-arrow-left"></i>
          </button>
        </div>
        
        <div class="space-y-4">
          <div>
            <label for="email" class="block text-gray-300 mb-2">Email</label>
            <input id="email" type="email" placeholder="your@email.com"
                    class="w-full px-4 py-3 rounded-lg bg-gray-700 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-primary transition"/>
          </div>
          
          <div>
            <label for="password" class="block text-gray-300 mb-2">Password</label>
            <input id="password" type="password" placeholder="••••••••"
                    class="w-full px-4 py-3 rounded-lg bg-gray-700 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-primary transition"/>
          </div>
          
          <div class="flex space-x-4 pt-2">
            <button onclick="register()"
                     class="flex-1 bg-secondary hover:bg-emerald-600 text-white font-bold py-3 px-4 rounded-lg transition transform hover:scale-[1.02]">
              Register
            </button>
            <button onclick="login()"
                     class="flex-1 bg-primary hover:bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg transition transform hover:scale-[1.02]">
              Login
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Admin Area: Podcast Upload -->
    <div id="adminArea" class="hidden w-full max-w-4xl">
      <div class="card rounded-2xl p-8 shadow-xl">
        <div class="flex justify-between items-center mb-8">
          <div>
            <h2 class="text-2xl font-semibold">Podcast Management</h2>
            <p class="text-gray-400 text-sm">Upload and manage your podcast episodes</p>
          </div>
          <button onclick="logout()" class="text-gray-400 hover:text-white flex items-center space-x-2 transition">
            <i class="fas fa-sign-out-alt"></i>
            <span>Logout</span>
          </button>
        </div>
        
        <div class="space-y-8">
          <div class="file-upload bg-gray-700 p-6 rounded-xl transition">
            <h3 class="text-xl font-medium mb-4">Upload New Podcast</h3>
            <div class="flex flex-col space-y-4">
              <div id="dropZone" class="flex flex-col items-center justify-center border-2 border-dashed border-gray-600 rounded-lg p-8 cursor-pointer transition hover:border-primary">
                <i class="fas fa-cloud-upload-alt text-4xl text-primary mb-3"></i>
                <p class="text-center mb-2">Drag & drop your audio file here</p>
                <p class="text-gray-400 text-sm mb-4">or</p>
                <label for="fileInput" class="cursor-pointer bg-primary hover:bg-indigo-600 text-white font-bold py-2 px-6 rounded-lg transition inline-flex items-center">
                  <i class="fas fa-file-audio mr-2"></i>
                  Browse Files
                </label>
                <input type="file" id="fileInput" accept="audio/*" class="hidden"/>
              </div>
              
              <div id="fileInfo" class="hidden bg-gray-800 rounded-lg p-4">
                <div class="flex justify-between items-center">
                  <div>
                    <p id="fileName" class="font-medium"></p>
                    <p id="fileSize" class="text-gray-400 text-sm"></p>
                  </div>
                  <button id="clearFile" class="text-gray-400 hover:text-white">
                    <i class="fas fa-times"></i>
                  </button>
                </div>
                <div class="mt-2">
                  <label for="podcastTitle" class="block text-gray-300 mb-1">Episode Title</label>
                  <input id="podcastTitle" type="text" placeholder="Enter episode title"
                         class="w-full px-3 py-2 rounded bg-gray-700 border border-gray-600 focus:outline-none focus:ring-1 focus:ring-primary"/>
                </div>
              </div>
              
              <button onclick="uploadFile()"
                      class="w-full bg-secondary hover:bg-emerald-600 text-white font-bold py-3 px-4 rounded-lg transition transform hover:scale-[1.02]">
                <i class="fas fa-cloud-upload-alt mr-2"></i>
                Upload Podcast
              </button>
              
              <p id="uploadStatus" class="text-sm text-center"></p>
            </div>
          </div>
          
          <div>
            <h3 class="text-xl font-medium mb-4">Your Podcasts</h3>
            <div id="adminPodcastList" class="space-y-4"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Listener Area: Podcasts -->
    <div id="listenerArea" class="hidden w-full max-w-4xl">
      <div class="card rounded-2xl p-8 shadow-xl">
        <div class="flex justify-between items-center mb-8">
          <div>
            <h2 class="text-2xl font-semibold">Discover Podcasts</h2>
            <p class="text-gray-400 text-sm">Listen to your favorite episodes</p>
          </div>
          <button onclick="logout()" class="text-gray-400 hover:text-white flex items-center space-x-2 transition">
            <i class="fas fa-sign-out-alt"></i>
            <span>Logout</span>
          </button>
        </div>
        
        <div class="mb-6">
          <div class="relative">
            <input id="searchInput" type="text" placeholder="Search podcasts..."
                    class="w-full px-4 py-3 pl-12 rounded-lg bg-gray-700 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-primary transition"
                   oninput="filterPodcasts()"/>
            <i class="fas fa-search absolute left-4 top-4 text-gray-400"></i>
          </div>
        </div>
        
        <div id="podcastList" class="space-y-6"></div>
        
        <div id="noResults" class="hidden text-center py-10">
          <i class="fas fa-podcast text-5xl text-gray-600 mb-4"></i>
          <h3 class="text-xl font-medium">No podcasts found</h3>
          <p class="text-gray-400">Try a different search term</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Firebase & Script -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-auth.js";
    import { getStorage, ref, uploadBytes, listAll, getDownloadURL, deleteObject } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-storage.js";

    const firebaseConfig = {
      apiKey: "AIzaSyC6G40ok1S6PbZSEM0vzKOOC5P-Am9Ul24",
      authDomain: "pocafy-1bfc5.firebaseapp.com",
      projectId: "pocafy-1bfc5",
      storageBucket: "pocafy-1bfc5.appspot.com",
      messagingSenderId: "967728384050",
      appId: "1:967728384050:web:dbab7568275ddba194942b"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const storage = getStorage(app);

    // File input and drag & drop handling
    const fileInput = document.getElementById('fileInput');
    const dropZone = document.getElementById('dropZone');
    const fileInfo = document.getElementById('fileInfo');
    const fileNameDisplay = document.getElementById('fileName');
    const fileSizeDisplay = document.getElementById('fileSize');
    const clearFileBtn = document.getElementById('clearFile');
    const podcastTitleInput = document.getElementById('podcastTitle');
    
    // Prevent default drag behaviors
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
      dropZone.addEventListener(eventName, preventDefaults, false);
      document.body.addEventListener(eventName, preventDefaults, false);
    });
    
    function preventDefaults(e) {
      e.preventDefault();
      e.stopPropagation();
    }
    
    // Highlight drop zone when item is dragged over it
    ['dragenter', 'dragover'].forEach(eventName => {
      dropZone.addEventListener(eventName, highlight, false);
    });
    
    ['dragleave', 'drop'].forEach(eventName => {
      dropZone.addEventListener(eventName, unhighlight, false);
    });
    
    function highlight() {
      dropZone.classList.add('dragover');
    }
    
    function unhighlight() {
      dropZone.classList.remove('dragover');
    }
    
    // Handle dropped files
    dropZone.addEventListener('drop', handleDrop, false);
    
    function handleDrop(e) {
      const dt = e.dataTransfer;
      const files = dt.files;
      if (files.length) {
        fileInput.files = files;
        handleFiles(files);
      }
    }
    
    // Handle selected files
    fileInput.addEventListener('change', function(e) {
      if (e.target.files.length) {
        handleFiles(e.target.files);
      }
    });
    
    // Clear selected file
    clearFileBtn.addEventListener('click', function() {
      fileInput.value = '';
      fileInfo.classList.add('hidden');
      podcastTitleInput.value = '';
    });
    
    // Display file info
    function handleFiles(files) {
      const file = files[0];
      fileNameDisplay.textContent = file.name;
      
      // Format file size
      const fileSize = file.size;
      let sizeStr;
      if (fileSize < 1024) {
        sizeStr = fileSize + ' bytes';
      } else if (fileSize < 1048576) {
        sizeStr = (fileSize / 1024).toFixed(1) + ' KB';
      } else {
        sizeStr = (fileSize / 1048576).toFixed(1) + ' MB';
      }
      fileSizeDisplay.textContent = sizeStr;
      
      // Set default title (filename without extension)
      const title = file.name.replace(/\.[^/.]+$/, "");
      podcastTitleInput.value = title;
      
      fileInfo.classList.remove('hidden');
    }

    // Admin Password check
    window.checkAdminPassword = function() {
      const password = document.getElementById('adminPassword').value;
      if (password === "123") {
        hideAll();
        document.getElementById('adminArea').classList.remove('hidden');
        loadAdminPodcasts();
      } else {
        alert("Wrong password! Try '123'");
      }
    }

    // Registration
    window.register = async function () {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      
      if (!email || !password) {
        alert("Please fill in all fields");
        return;
      }
      
      try {
        await createUserWithEmailAndPassword(auth, email, password);
        showListenerArea();
      } catch (error) {
        alert("Error: " + error.message);
      }
    }

    // Login
    window.login = async function () {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      
      if (!email || !password) {
        alert("Please fill in all fields");
        return;
      }
      
      try {
        await signInWithEmailAndPassword(auth, email, password);
        showListenerArea();
      } catch (error) {
        alert("Error: " + error.message);
      }
    }

    // Logout
    window.logout = async function () {
      try {
        await signOut(auth);
        backToRoleSelection();
        // Clear inputs
        document.getElementById('email').value = '';
        document.getElementById('password').value = '';
        document.getElementById('adminPassword').value = '';
      } catch (error) {
        console.error("Logout error:", error);
      }
    }

    // Show listener area + load podcasts
    function showListenerArea() {
      hideAll();
      document.getElementById('listenerArea').classList.remove('hidden');
      loadPodcasts();
    }

    // Podcast upload (Admin)
    window.uploadFile = async function () {
      if (!fileInput.files.length) {
        document.getElementById('uploadStatus').textContent = "Please select a file first";
        document.getElementById('uploadStatus').className = "text-sm text-center text-red-400";
        return;
      }
      
      const file = fileInput.files[0];
      const title = podcastTitleInput.value || file.name.replace(/\.[^/.]+$/, "");
      const storageRef = ref(storage, 'podcasts/' + file.name);

      document.getElementById('uploadStatus').textContent = "Uploading...";
      document.getElementById('uploadStatus').className = "text-sm text-center text-yellow-400";
      
      try {
        await uploadBytes(storageRef, file);
        document.getElementById('uploadStatus').textContent = "Upload successful!";
        document.getElementById('uploadStatus').className = "text-sm text-center text-green-400";
        
        // Reset form
        fileInput.value = '';
        fileInfo.classList.add('hidden');
        podcastTitleInput.value = '';
        
        // Reload podcast list
        loadAdminPodcasts();
      } catch (error) {
        document.getElementById('uploadStatus').textContent = "Upload failed: " + error.message;
        document.getElementById('uploadStatus').className = "text-sm text-center text-red-400";
      }
    }

    // Load podcasts (Listener)
    async function loadPodcasts() {
      const listRef = ref(storage, 'podcasts');
      const podcastList = document.getElementById('podcastList');
      podcastList.innerHTML = '<div class="text-center py-8"><i class="fas fa-spinner fa-spin text-2xl text-primary"></i></div>';
      
      try {
        const res = await listAll(listRef);
        
        if (res.items.length === 0) {
          podcastList.innerHTML = `
            <div class="text-center py-10">
              <i class="fas fa-podcast text-5xl text-gray-600 mb-4"></i>
              <h3 class="text-xl font-medium">No podcasts available</h3>
              <p class="text-gray-400">The admin hasn't uploaded any podcasts yet</p>
            </div>
          `;
          return;
        }
        
        podcastList.innerHTML = '';
        
        for (const itemRef of res.items) {
          const url = await getDownloadURL(itemRef);
          const fileName = itemRef.name.replace(/\.[^/.]+$/, ""); // Remove file extension
          
          const div = document.createElement('div');
          div.className = "podcast-card p-6 rounded-xl transition";
          div.innerHTML = `
            <div class="flex justify-between items-start mb-4">
              <div>
                <h3 class="font-semibold text-xl mb-1">${fileName}</h3>
                <div class="flex items-center space-x-3 text-sm text-gray-400">
                  <span><i class="fas fa-headphones mr-1"></i> Podcast</span>
                  <span><i class="fas fa-clock mr-1"></i> 45 min</span>
                </div>
              </div>
              <span class="text-xs bg-gray-600 px-2 py-1 rounded-full">Audio</span>
            </div>
            <audio controls class="audio-player">
              <source src="${url}" type="audio/mpeg">
              Your browser does not support the audio element.
            </audio>
          `;
          podcastList.appendChild(div);
        }
      } catch (error) {
        podcastList.innerHTML = `
          <div class="text-center py-10 text-red-400">
            <i class="fas fa-exclamation-triangle text-3xl mb-3"></i>
            <p>Error loading podcasts. Please try again later.</p>
          </div>
        `;
      }
    }

    // Load podcasts (Admin)
    async function loadAdminPodcasts() {
      const listRef = ref(storage, 'podcasts');
      const podcastList = document.getElementById('adminPodcastList');
      podcastList.innerHTML = '<div class="text-center py-8"><i class="fas fa-spinner fa-spin text-2xl text-primary"></i></div>';
      
      try {
        const res = await listAll(listRef);
        
        if (res.items.length === 0) {
          podcastList.innerHTML = `
            <div class="text-center py-10">
              <i class="fas fa-podcast text-5xl text-gray-600 mb-4"></i>
              <h3 class="text-xl font-medium">No podcasts uploaded yet</h3>
              <p class="text-gray-400">Upload your first podcast using the form above</p>
            </div>
          `;
          return;
        }
        
        podcastList.innerHTML = '';
        
        for (const itemRef of res.items) {
          const url = await getDownloadURL(itemRef);
          const fileName = itemRef.name;
          const displayName = fileName.replace(/\.[^/.]+$/, ""); // Remove file extension
          
          const div = document.createElement('div');
          div.className = "podcast-card p-6 rounded-xl transition";
          div.innerHTML = `
            <div class="flex justify-between items-start mb-4">
              <div>
                <h3 class="font-semibold text-xl mb-1">${displayName}</h3>
                <div class="flex items-center space-x-3 text-sm text-gray-400">
                  <span><i class="fas fa-headphones mr-1"></i> Podcast</span>
                  <span><i class="fas fa-clock mr-1"></i> 45 min</span>
                </div>
              </div>
              <span class="text-xs bg-gray-600 px-2 py-1 rounded-full">Audio</span>
            </div>
            <div class="flex items-center space-x-4">
              <audio controls class="flex-1 audio-player">
                <source src="${url}" type="audio/mpeg">
                Your browser does not support the audio element.
              </audio>
              <button onclick="deletePodcast('${fileName}')" class="text-red-400 hover:text-red-300 transition">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          `;
          podcastList.appendChild(div);
        }
      } catch (error) {
        podcastList.innerHTML = `
          <div class="text-center py-10 text-red-400">
            <i class="fas fa-exclamation-triangle text-3xl mb-3"></i>
            <p>Error loading podcasts. Please try again later.</p>
          </div>
        `;
      }
    }

    // Delete podcast (Admin)
    window.deletePodcast = async function(fileName) {
      if (!confirm("Are you sure you want to delete this podcast?")) return;
      
      try {
        const fileRef = ref(storage, 'podcasts/' + fileName);
        await deleteObject(fileRef);
        loadAdminPodcasts();
      } catch (error) {
        alert("Error deleting podcast: " + error.message);
      }
    }

    // Filter podcasts by search term
    window.filterPodcasts = function() {
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      const podcastCards = document.querySelectorAll('.podcast-card');
      let visibleCount = 0;
      
      podcastCards.forEach(card => {
        const title = card.querySelector('h3').textContent.toLowerCase();
        if (title.includes(searchTerm)) {
          card.style.display = 'block';
          visibleCount++;
        } else {
          card.style.display = 'none';
        }
      });
      
      document.getElementById('noResults').classList.toggle('hidden', visibleCount > 0);
    }
  </script>
</body>
</html>
